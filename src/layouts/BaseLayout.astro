---
import '../styles/global.css';
import { siteConfig } from '../config';

interface Props {
  title: string;
  description?: string;
  showNav?: boolean;
}

const { title, description = siteConfig.description, showNav = true } = Astro.props;

const copyrightText = siteConfig.copyright
  .replace('{siteName}', siteConfig.siteName)
  .replace('{year}', new Date().getFullYear().toString())
  .replace('{author}', siteConfig.author);
---

<!doctype html>
<html lang={siteConfig.lang}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    <title>{title} | {siteConfig.siteName}</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <!-- 防止主题闪烁 -->
    <script is:inline>
      (function() {
        const theme = document.cookie.match(/theme=(\w+)/)?.[1] || 'light';
        if (theme === 'dark') {
          document.documentElement.classList.add('dark');
        }
      })();
    </script>
  </head>
  <body>
    {showNav && (
      <nav class="navbar">
        <div class="nav-content">
          <a href="/" class="nav-title">{siteConfig.siteName}</a>
          <div class="nav-right">
            {siteConfig.navLinks.map((link) => (
              <a href={link.href} class="nav-link">{link.text}</a>
            ))}
            <div class="theme-switch" id="theme-switch" aria-label="切换主题">
              <span class="theme-slider"></span>
              <button class="theme-option theme-light-btn" data-theme="light" aria-label="浅色模式">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41l-1.06-1.06zm1.06-10.96c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z"/>
                </svg>
              </button>
              <button class="theme-option theme-dark-btn" data-theme="dark" aria-label="深色模式">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-2.98 0-5.4-2.42-5.4-5.4 0-1.81.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"/>
                </svg>
              </button>
            </div>
          </div>
        </div>
      </nav>
    )}
    <main class="content">
      <slot />
    </main>
    <footer class="footer">
      <p>{copyrightText}</p>
    </footer>
  </body>
</html>

<style>
  .navbar {
    height: 60px;
    width: 100%;
    background-color: #2f4258;
    display: flex;
    align-items: center;
    transition: background-color 0.3s ease;
  }

  html.dark .navbar {
    background-color: #1c2128;
  }

  .nav-content {
    max-width: 960px;
    width: 100%;
    margin: 0 auto;
    padding: 0;
    display: flex;
    align-items: center;
  }

  .nav-title {
    color: white;
    font-size: 24px;
    font-weight: bold;
    text-decoration: none;
    transition: color 0.3s ease;
  }

  .nav-title:hover {
    opacity: 0.9;
  }

  html.dark .nav-title {
    color: var(--primary-color);
  }

  .nav-right {
    margin-left: auto;
    display: flex;
    align-items: center;
    gap: 16px;
  }

  .nav-link {
    color: white;
    text-decoration: none;
    font-size: 16px;
  }

  .nav-link:hover {
    opacity: 0.8;
  }

  .content {
    max-width: 960px;
    margin: 0 auto;
    padding: 20px 0;
    min-height: calc(100vh - 60px - 80px);
  }

  @media (max-width: 768px) {
    .nav-content {
      padding: 0 16px;
    }

    .content {
      padding: 12px 16px 0 16px;
    }
  }

  .footer {
    text-align: center;
    margin-top: 40px;
    padding: 20px 0 10px;
    border-top: 1px solid var(--line-color);
    color: var(--secondary-color);
    font-size: 14px;
  }

</style>

<style is:global>
  .theme-switch {
    display: flex;
    align-items: center;
    background-color: rgba(255, 255, 255, 0.15);
    border-radius: 20px;
    padding: 3px;
    position: relative;
  }

  html.dark .theme-switch {
    background-color: rgba(255, 255, 255, 0.1);
  }

  /* 滑块 */
  .theme-slider {
    position: absolute;
    width: 32px;
    height: 28px;
    background-color: rgba(255, 255, 255, 0.3);
    border-radius: 16px;
    left: 3px;
    transition: transform 0.25s ease;
    pointer-events: none;
  }

  html.dark .theme-slider {
    transform: translateX(32px);
    background-color: rgba(255, 255, 255, 0.15);
  }

  .theme-option {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 28px;
    border: none;
    background: none;
    border-radius: 16px;
    cursor: pointer;
    color: rgba(255, 255, 255, 0.5);
    transition: color 0.25s;
    position: relative;
    z-index: 1;
  }

  .theme-option:hover {
    color: white;
  }

  /* 浅色模式：太阳按钮高亮 */
  .theme-light-btn {
    color: white;
  }

  /* 深色模式：月亮按钮高亮 */
  html.dark .theme-light-btn {
    color: rgba(255, 255, 255, 0.5);
  }

  html.dark .theme-light-btn:hover {
    color: var(--primary-color);
  }

  html.dark .theme-dark-btn {
    color: var(--primary-color);
  }
</style>

<script>
  function initThemeToggle() {
    const themeSwitch = document.getElementById('theme-switch');
    if (!themeSwitch) return;

    const setTheme = (theme: 'light' | 'dark') => {
      if (theme === 'dark') {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
      document.cookie = `theme=${theme};path=/;max-age=31536000`;
    };

    themeSwitch.addEventListener('click', (e) => {
      const target = e.target as HTMLElement;
      const btn = target.closest('.theme-option') as HTMLElement;
      if (btn) {
        const theme = btn.dataset.theme as 'light' | 'dark';
        setTheme(theme);
      }
    });
  }

  document.addEventListener('DOMContentLoaded', initThemeToggle);
  document.addEventListener('astro:page-load', initThemeToggle);
</script>
